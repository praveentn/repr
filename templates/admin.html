<!-- templates/admin_panel.html Admin Panel -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Knowledge Representation Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        
        .admin-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        
        .admin-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 10px 25px -3px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar-active {
            @apply bg-blue-600 text-white;
        }
        
        .table-hover:hover {
            @apply bg-blue-50;
        }
        
        .animate-fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading-overlay {
            @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
        }
        
        .spinner {
            @apply animate-spin rounded-full h-12 w-12 border-b-2 border-white;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div x-data="adminApp()" class="flex">
        
        <!-- Sidebar -->
        <div class="w-64 bg-white shadow-lg min-h-screen">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center">
                    <div class="w-10 h-10 bg-gradient-to-r from-blue-600 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="fas fa-cog text-white"></i>
                    </div>
                    <div class="ml-3">
                        <h1 class="text-lg font-semibold text-gray-800">Admin Panel</h1>
                        <p class="text-sm text-gray-600">Knowledge Rep System</p>
                    </div>
                </div>
            </div>
            
            <nav class="mt-6">
                <template x-for="item in sidebarItems" :key="item.id">
                    <button 
                        @click="activeTab = item.id"
                        :class="activeTab === item.id ? 'sidebar-active' : 'text-gray-700 hover:bg-gray-100'"
                        class="w-full flex items-center px-6 py-3 text-left transition-colors"
                    >
                        <i :class="item.icon" class="mr-3"></i>
                        <span x-text="item.name"></span>
                    </button>
                </template>
            </nav>
            
            <div class="absolute bottom-6 left-6 right-6">
                <a href="/" class="flex items-center text-gray-600 hover:text-blue-600 transition-colors">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Back to App
                </a>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 overflow-hidden">
            <div class="p-8">
                
                <!-- Header -->
                <div class="mb-8">
                    <h2 class="text-3xl font-bold text-gray-800" x-text="getCurrentTabName()"></h2>
                    <p class="text-gray-600 mt-1" x-text="getCurrentTabDescription()"></p>
                </div>
                
                <!-- Dashboard Tab -->
                <div x-show="activeTab === 'dashboard'" class="animate-fade-in">
                    
                    <!-- Stats Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <template x-for="stat in dashboardStats" :key="stat.label">
                            <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm font-medium text-gray-600" x-text="stat.label"></p>
                                        <p class="text-2xl font-bold text-gray-900" x-text="stat.value"></p>
                                        <p class="text-xs text-gray-500" x-text="stat.change"></p>
                                    </div>
                                    <div :class="`text-3xl ${stat.color}`">
                                        <i :class="stat.icon"></i>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- Charts Row -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        
                        <!-- Usage Chart -->
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">Daily Conversations</h3>
                            <canvas id="usageChart" width="400" height="200"></canvas>
                        </div>
                        
                        <!-- Popular Modes Chart -->
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">Popular Representation Modes</h3>
                            <canvas id="modesChart" width="400" height="200"></canvas>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="admin-card bg-white rounded-xl shadow-lg">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold">Recent Conversations</h3>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full">
                                <thead class="bg-gray-50">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Session</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Query</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Mode</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tokens</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Time</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="conv in recentConversations" :key="conv.id">
                                        <tr class="table-hover">
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="conv.session_id.substring(0, 8) + '...'"></td>
                                            <td class="px-6 py-4 text-sm text-gray-900" x-text="conv.user_query.substring(0, 50) + '...'"></td>
                                            <td class="px-6 py-4 whitespace-nowrap">
                                                <span class="px-2 py-1 text-xs font-medium bg-blue-100 text-blue-800 rounded-full" x-text="conv.representation_mode"></span>
                                            </td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="conv.tokens"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="conv.processing_time + 's'"></td>
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatDate(conv.timestamp)"></td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Database Tab -->
                <div x-show="activeTab === 'database'" class="animate-fade-in">
                    
                    <!-- Database Controls -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">Database Actions</h3>
                            <div class="space-y-3">
                                <button @click="optimizeDatabase()" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-wrench mr-2"></i>
                                    Optimize Database
                                </button>
                                <button @click="backupDatabase()" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors">
                                    <i class="fas fa-download mr-2"></i>
                                    Create Backup
                                </button>
                                <button @click="analyzeDatabase()" class="w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition-colors">
                                    <i class="fas fa-chart-line mr-2"></i>
                                    Analyze Tables
                                </button>
                            </div>
                        </div>
                        
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">Table Selector</h3>
                            <select x-model="selectedTable" @change="loadTableData()" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                                <option value="">Select a table...</option>
                                <template x-for="table in databaseTables" :key="table">
                                    <option :value="table" x-text="table"></option>
                                </template>
                            </select>
                            <div class="mt-4 space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Page:</span>
                                    <input x-model="currentPage" @change="loadTableData()" type="number" min="1" class="w-16 text-sm border border-gray-300 rounded px-2 py-1">
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-sm text-gray-600">Per page:</span>
                                    <select x-model="pageSize" @change="loadTableData()" class="text-sm border border-gray-300 rounded px-2 py-1">
                                        <option value="20">20</option>
                                        <option value="50">50</option>
                                        <option value="100">100</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">Table Statistics</h3>
                            <div x-show="tableData" class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Records:</span>
                                    <span class="font-medium" x-text="tableData?.pagination?.total || 0"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Total Pages:</span>
                                    <span class="font-medium" x-text="tableData?.pagination?.pages || 0"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Columns:</span>
                                    <span class="font-medium" x-text="tableData?.columns?.length || 0"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Table Data Display -->
                    <div x-show="tableData" class="admin-card bg-white rounded-xl shadow-lg">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold" x-text="`Table: ${selectedTable}`"></h3>
                        </div>
                        <div class="overflow-x-auto max-h-96">
                            <table class="w-full">
                                <thead class="bg-gray-50 sticky top-0">
                                    <tr>
                                        <template x-for="column in tableData?.columns" :key="column.name">
                                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase" x-text="column.name"></th>
                                        </template>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-gray-200">
                                    <template x-for="row in tableData?.data" :key="row.id || Math.random()">
                                        <tr class="table-hover">
                                            <template x-for="column in tableData?.columns" :key="column.name">
                                                <td class="px-4 py-3 text-sm text-gray-900 max-w-xs truncate" x-text="row[column.name] || '-'"></td>
                                            </template>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- SQL Query Executor -->
                    <div class="mt-8 admin-card bg-white rounded-xl shadow-lg">
                        <div class="p-6 border-b border-gray-200">
                            <h3 class="text-lg font-semibold text-red-600">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                SQL Query Executor (Read-Only)
                            </h3>
                            <p class="text-sm text-gray-600 mt-1">Only SELECT queries are allowed for security reasons</p>
                        </div>
                        <div class="p-6">
                            <textarea 
                                x-model="sqlQuery" 
                                placeholder="SELECT * FROM conversations LIMIT 10;"
                                class="w-full h-32 p-3 border border-gray-300 rounded font-mono text-sm focus:ring-2 focus:ring-blue-500 resize-none"
                            ></textarea>
                            <div class="flex justify-between items-center mt-4">
                                <div class="flex items-center space-x-4">
                                    <button @click="executeSqlQuery()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition-colors">
                                        <i class="fas fa-play mr-2"></i>
                                        Execute Query
                                    </button>
                                    <button @click="sqlQuery = ''" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700 transition-colors">
                                        Clear
                                    </button>
                                </div>
                                <div class="text-sm text-gray-500">
                                    Results limited to 1000 rows
                                </div>
                            </div>
                            
                            <!-- Query Results -->
                            <div x-show="queryResults" class="mt-6">
                                <h4 class="font-semibold mb-3">Query Results:</h4>
                                <div class="overflow-x-auto max-h-64 border border-gray-300 rounded">
                                    <table class="w-full text-sm">
                                        <thead class="bg-gray-50 sticky top-0">
                                            <tr>
                                                <template x-for="column in Object.keys(queryResults[0] || {})" :key="column">
                                                    <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase" x-text="column"></th>
                                                </template>
                                            </tr>
                                        </thead>
                                        <tbody class="bg-white divide-y divide-gray-200">
                                            <template x-for="row in queryResults" :key="Math.random()">
                                                <tr>
                                                    <template x-for="column in Object.keys(queryResults[0] || {})" :key="column">
                                                        <td class="px-3 py-2 text-gray-900 max-w-xs truncate" x-text="row[column] || '-'"></td>
                                                    </template>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Tab -->
                <div x-show="activeTab === 'analytics'" class="animate-fade-in">
                    
                    <!-- Analytics Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                        
                        <!-- Token Usage Over Time -->
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">Token Usage Trends</h3>
                            <canvas id="tokenChart" width="400" height="200"></canvas>
                        </div>
                        
                        <!-- Response Time Distribution -->
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">Response Time Distribution</h3>
                            <canvas id="responseTimeChart" width="400" height="200"></canvas>
                        </div>
                        
                        <!-- User Engagement -->
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">User Engagement Metrics</h3>
                            <div class="space-y-4">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Avg. Conversations per Session:</span>
                                    <span class="font-semibold" x-text="analytics.avgConversationsPerSession || 0"></span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Avg. Processing Time:</span>
                                    <span class="font-semibold" x-text="(analytics.avgProcessingTime || 0).toFixed(2) + 's'"></span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Most Popular Mode:</span>
                                    <span class="font-semibold" x-text="analytics.mostPopularMode || 'N/A'"></span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Total Cost Estimate:</span>
                                    <span class="font-semibold" x-text="'$' + (analytics.totalCostEstimate || 0).toFixed(4)"></span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Export Tools -->
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">Export & Reports</h3>
                            <div class="space-y-3">
                                <button @click="exportConversations('json')" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-file-code mr-2"></i>
                                    Export as JSON
                                </button>
                                <button @click="exportConversations('csv')" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors">
                                    <i class="fas fa-file-csv mr-2"></i>
                                    Export as CSV
                                </button>
                                <button @click="generateReport()" class="w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700 transition-colors">
                                    <i class="fas fa-chart-pie mr-2"></i>
                                    Generate Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Settings Tab -->
                <div x-show="activeTab === 'settings'" class="animate-fade-in">
                    
                    <!-- Settings Grid -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        
                        <!-- LLM Configuration -->
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">LLM Configuration</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Model</label>
                                    <select x-model="llmConfig.model" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                                        <option value="gpt-4.1-nano">GPT-4.1 Nano</option>
                                        <option value="gpt-4">GPT-4</option>
                                        <option value="gpt-35-turbo">GPT-3.5 Turbo</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Temperature: <span x-text="llmConfig.temperature"></span></label>
                                    <input x-model="llmConfig.temperature" type="range" min="0" max="2" step="0.1" class="w-full">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Max Tokens</label>
                                    <input x-model="llmConfig.max_tokens" type="number" min="100" max="4000" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Top P: <span x-text="llmConfig.top_p"></span></label>
                                    <input x-model="llmConfig.top_p" type="range" min="0" max="1" step="0.1" class="w-full">
                                </div>
                                <button @click="updateLLMConfig()" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors">
                                    Update Configuration
                                </button>
                            </div>
                        </div>
                        
                        <!-- System Settings -->
                        <div class="admin-card bg-white rounded-xl p-6 shadow-lg">
                            <h3 class="text-lg font-semibold mb-4">System Settings</h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Enable Analytics</span>
                                    <input x-model="systemSettings.analytics_enabled" type="checkbox" class="rounded">
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Auto-backup</span>
                                    <input x-model="systemSettings.auto_backup" type="checkbox" class="rounded">
                                </div>
                                <div class="flex items-center justify-between">
                                    <span class="text-sm font-medium text-gray-700">Debug Mode</span>
                                    <input x-model="systemSettings.debug_mode" type="checkbox" class="rounded">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Max Sessions per Hour</label>
                                    <input x-model="systemSettings.rate_limit" type="number" min="10" max="1000" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500">
                                </div>
                                <button @click="updateSystemSettings()" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition-colors">
                                    Save Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Loading Overlay -->
        <div x-show="loading" class="loading-overlay">
            <div class="text-center">
                <div class="spinner"></div>
                <p class="text-white mt-4" x-text="loadingMessage"></p>
            </div>
        </div>
        
        <!-- Toast Notifications -->
        <div x-show="showToast" x-transition class="fixed top-4 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg z-50">
            <span x-text="toastMessage"></span>
        </div>
    </div>

    <script>
        function adminApp() {
            return {
                // State
                activeTab: 'dashboard',
                loading: false,
                loadingMessage: '',
                showToast: false,
                toastMessage: '',
                
                // Data
                dashboardStats: [],
                recentConversations: [],
                databaseTables: [],
                selectedTable: '',
                currentPage: 1,
                pageSize: 20,
                tableData: null,
                sqlQuery: '',
                queryResults: null,
                analytics: {},
                
                // Configuration
                llmConfig: {
                    model: 'gpt-4.1-nano',
                    temperature: 0.7,
                    max_tokens: 2000,
                    top_p: 1.0
                },
                
                systemSettings: {
                    analytics_enabled: true,
                    auto_backup: false,
                    debug_mode: false,
                    rate_limit: 100
                },
                
                // Navigation
                sidebarItems: [
                    { id: 'dashboard', name: 'Dashboard', icon: 'fas fa-chart-line', description: 'System overview and statistics' },
                    { id: 'database', name: 'Database', icon: 'fas fa-database', description: 'Database management and queries' },
                    { id: 'analytics', name: 'Analytics', icon: 'fas fa-chart-pie', description: 'Detailed usage analytics' },
                    { id: 'settings', name: 'Settings', icon: 'fas fa-cog', description: 'System configuration' }
                ],
                
                // Initialization
                async init() {
                    await this.loadDashboardData();
                    await this.loadDatabaseTables();
                    this.initializeCharts();
                },
                
                // Methods
                getCurrentTabName() {
                    const tab = this.sidebarItems.find(item => item.id === this.activeTab);
                    return tab ? tab.name : 'Dashboard';
                },
                
                getCurrentTabDescription() {
                    const tab = this.sidebarItems.find(item => item.id === this.activeTab);
                    return tab ? tab.description : '';
                },
                
                async loadDashboardData() {
                    this.loading = true;
                    this.loadingMessage = 'Loading dashboard data...';
                    
                    try {
                        const response = await fetch('/api/admin/stats');
                        const data = await response.json();
                        
                        this.dashboardStats = [
                            { label: 'Total Conversations', value: data.total_conversations, change: '+12% this week', icon: 'fas fa-comments', color: 'text-blue-600' },
                            { label: 'Active Sessions', value: data.total_sessions, change: '+5% this week', icon: 'fas fa-users', color: 'text-green-600' },
                            { label: 'Today\'s Queries', value: data.todays_conversations, change: 'Real-time', icon: 'fas fa-clock', color: 'text-purple-600' },
                            { label: 'Total Tokens', value: data.token_usage?.total_tokens?.toLocaleString() || '0', change: 'Cost: $' + (data.token_usage?.total_cost || 0).toFixed(4), icon: 'fas fa-coins', color: 'text-yellow-600' }
                        ];
                        
                        // Load recent conversations
                        const conversationsResponse = await fetch('/api/admin/conversations?limit=10');
                        const conversationsData = await conversationsResponse.json();
                        this.recentConversations = conversationsData.conversations || [];
                        
                    } catch (error) {
                        console.error('Error loading dashboard data:', error);
                        this.showToastMessage('Error loading dashboard data');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async loadDatabaseTables() {
                    try {
                        const response = await fetch('/api/admin/tables');
                        const data = await response.json();
                        this.databaseTables = data.tables || [];
                    } catch (error) {
                        console.error('Error loading database tables:', error);
                    }
                },
                
                async loadTableData() {
                    if (!this.selectedTable) return;
                    
                    this.loading = true;
                    this.loadingMessage = `Loading ${this.selectedTable} data...`;
                    
                    try {
                        const response = await fetch(`/api/admin/table/${this.selectedTable}?page=${this.currentPage}&limit=${this.pageSize}`);
                        this.tableData = await response.json();
                    } catch (error) {
                        console.error('Error loading table data:', error);
                        this.showToastMessage('Error loading table data');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async executeSqlQuery() {
                    if (!this.sqlQuery.trim()) return;
                    
                    this.loading = true;
                    this.loadingMessage = 'Executing query...';
                    
                    try {
                        const response = await fetch('/api/admin/query', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ query: this.sqlQuery })
                        });
                        
                        const data = await response.json();
                        this.queryResults = data.result;
                        this.showToastMessage('Query executed successfully');
                    } catch (error) {
                        console.error('Error executing query:', error);
                        this.showToastMessage('Error executing query');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async optimizeDatabase() {
                    this.loading = true;
                    this.loadingMessage = 'Optimizing database...';
                    
                    try {
                        // Simulate database optimization
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        this.showToastMessage('Database optimized successfully');
                    } catch (error) {
                        this.showToastMessage('Error optimizing database');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async backupDatabase() {
                    this.loading = true;
                    this.loadingMessage = 'Creating backup...';
                    
                    try {
                        // Simulate backup creation
                        await new Promise(resolve => setTimeout(resolve, 3000));
                        this.showToastMessage('Backup created successfully');
                    } catch (error) {
                        this.showToastMessage('Error creating backup');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async analyzeDatabase() {
                    this.loading = true;
                    this.loadingMessage = 'Analyzing database...';
                    
                    try {
                        // Simulate database analysis
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        this.showToastMessage('Database analysis completed');
                    } catch (error) {
                        this.showToastMessage('Error analyzing database');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async updateLLMConfig() {
                    try {
                        // API call to update LLM configuration
                        this.showToastMessage('LLM configuration updated');
                    } catch (error) {
                        this.showToastMessage('Error updating LLM configuration');
                    }
                },
                
                async updateSystemSettings() {
                    try {
                        // API call to update system settings
                        this.showToastMessage('System settings saved');
                    } catch (error) {
                        this.showToastMessage('Error saving system settings');
                    }
                },
                
                async exportConversations(format) {
                    this.loading = true;
                    this.loadingMessage = `Exporting as ${format.toUpperCase()}...`;
                    
                    try {
                        // Simulate export
                        await new Promise(resolve => setTimeout(resolve, 2000));
                        this.showToastMessage(`Export completed as ${format.toUpperCase()}`);
                    } catch (error) {
                        this.showToastMessage('Error exporting data');
                    } finally {
                        this.loading = false;
                    }
                },
                
                async generateReport() {
                    this.loading = true;
                    this.loadingMessage = 'Generating report...';
                    
                    try {
                        // Simulate report generation
                        await new Promise(resolve => setTimeout(resolve, 3000));
                        this.showToastMessage('Report generated successfully');
                    } catch (error) {
                        this.showToastMessage('Error generating report');
                    } finally {
                        this.loading = false;
                    }
                },
                
                initializeCharts() {
                    // Initialize Chart.js charts
                    this.$nextTick(() => {
                        this.initUsageChart();
                        this.initModesChart();
                        this.initTokenChart();
                        this.initResponseTimeChart();
                    });
                },
                
                initUsageChart() {
                    const ctx = document.getElementById('usageChart');
                    if (!ctx) return;
                    
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                            datasets: [{
                                label: 'Conversations',
                                data: [12, 19, 13, 25, 22, 18, 25],
                                borderColor: 'rgb(59, 130, 246)',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });
                },
                
                initModesChart() {
                    const ctx = document.getElementById('modesChart');
                    if (!ctx) return;
                    
                    new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Plain Text', 'Color Coded', 'Knowledge Graph', 'Summary', 'Other'],
                            datasets: [{
                                data: [30, 25, 20, 15, 10],
                                backgroundColor: [
                                    'rgb(59, 130, 246)',
                                    'rgb(16, 185, 129)',
                                    'rgb(139, 92, 246)',
                                    'rgb(245, 158, 11)',
                                    'rgb(239, 68, 68)'
                                ]
                            }]
                        },
                        options: {
                            responsive: true
                        }
                    });
                },
                
                initTokenChart() {
                    const ctx = document.getElementById('tokenChart');
                    if (!ctx) return;
                    
                    new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                            datasets: [{
                                label: 'Tokens Used',
                                data: [15000, 22000, 18000, 25000],
                                backgroundColor: 'rgba(139, 92, 246, 0.8)'
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });
                },
                
                initResponseTimeChart() {
                    const ctx = document.getElementById('responseTimeChart');
                    if (!ctx) return;
                    
                    new Chart(ctx, {
                        type: 'histogram',
                        data: {
                            labels: ['0-1s', '1-2s', '2-3s', '3-4s', '4-5s', '5s+'],
                            datasets: [{
                                label: 'Response Count',
                                data: [45, 78, 52, 23, 12, 5],
                                backgroundColor: 'rgba(16, 185, 129, 0.8)'
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: { beginAtZero: true }
                            }
                        }
                    });
                },
                
                showToastMessage(message) {
                    this.toastMessage = message;
                    this.showToast = true;
                    setTimeout(() => { this.showToast = false; }, 3000);
                },
                
                formatDate(dateString) {
                    return new Date(dateString).toLocaleDateString();
                }
            }
        }
    </script>
</body>
</html>
